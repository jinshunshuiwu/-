<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘é¡ºç¨åŠ¡é—¨åº—ä¿æœ¬ä¿åˆ©è®¡ç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .input-group {
            transition: all 0.3s ease;
        }
        .input-group:focus-within {
            transform: translateX(5px);
        }
        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            animation: pulse-glow 2s infinite;
        }
        .result-card-profit {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            animation: pulse-glow-blue 2s infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 10px 30px rgba(245, 87, 108, 0.3); }
            50% { box-shadow: 0 10px 40px rgba(245, 87, 108, 0.5); }
        }
        @keyframes pulse-glow-blue {
            0%, 100% { box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3); }
            50% { box-shadow: 0 10px 40px rgba(79, 172, 254, 0.5); }
        }
        .cost-item {
            transition: all 0.3s ease;
        }
        .cost-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .highlight-input {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border: 2px solid #667eea;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8 text-white">
            <h1 class="text-4xl font-bold mb-2">ğŸª é‡‘é¡ºç¨åŠ¡é—¨åº—ä¿æœ¬ä¿åˆ©è®¡ç®—å™¨</h1>
            <p class="text-lg opacity-90">ç²¾å‡†è®¡ç®—ä¿æœ¬ç‚¹ä¸ä¿åˆ©ç‚¹ï¼ŒåŠ©åŠ›ç»è¥å†³ç­–</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-6">
            <!-- å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ -->
            <div class="glass-panel rounded-2xl p-6 shadow-2xl">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                    æˆæœ¬å‚æ•°è®¾ç½®
                </h2>

                <!-- å›ºå®šæˆæœ¬ -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">å›ºå®šæˆæœ¬ï¼ˆæ¯æœˆï¼‰</h3>
                    
                    <div class="space-y-4">
                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">æˆ¿ç§Ÿ/ç‰©ä¸š</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2 text-gray-500">Â¥</span>
                                <input type="number" id="rent" class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" oninput="calculate()">
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">å›ºå®šäººå·¥æˆæœ¬ï¼ˆåº•è–ªï¼‰</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2 text-gray-500">Â¥</span>
                                <input type="number" id="fixedLabor" class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" oninput="calculate()">
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ä¸å«ææˆçš„å›ºå®šè–ªèµ„æ”¯å‡º</p>
                        </div>

                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">æ°´ç”µè´¹</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2 text-gray-500">Â¥</span>
                                <input type="number" id="utilities" class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" oninput="calculate()">
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">è®¾å¤‡æŠ˜æ—§/ç»´æŠ¤/è£…ä¿®è´¹æ‘Šé”€</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2 text-gray-500">Â¥</span>
                                <input type="number" id="maintenance" class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" oninput="calculate()">
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">å…¶ä»–å›ºå®šè´¹ç”¨</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2 text-gray-500">Â¥</span>
                                <input type="number" id="otherFixed" class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" oninput="calculate()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å˜åŠ¨æˆæœ¬ -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">å˜åŠ¨æˆæœ¬ï¼ˆå æ”¶å…¥æ¯”ä¾‹ï¼‰</h3>
                    
                    <div class="space-y-4">
                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">å•†å“æˆæœ¬ç‡</label>
                            <div class="relative">
                                <input type="number" id="cogsRate" class="w-full pl-4 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" step="0.1" oninput="calculate()">
                                <span class="absolute right-3 top-2 text-gray-500">%</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">è¿›è´§æˆæœ¬å é”€å”®æ”¶å…¥çš„æ¯”ä¾‹</p>
                        </div>

                        <div class="input-group bg-orange-50 p-3 rounded-lg border border-orange-200">
                            <label class="block text-sm font-medium text-orange-700 mb-1">å˜åŠ¨äººå·¥æˆæœ¬ï¼ˆææˆ/å¥–é‡‘ç‡ï¼‰</label>
                            <div class="relative">
                                <input type="number" id="variableLaborRate" class="w-full pl-4 pr-8 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white" placeholder="0" step="0.1" oninput="calculate()">
                                <span class="absolute right-3 top-2 text-gray-500">%</span>
                            </div>
                            <p class="text-xs text-orange-600 mt-1">é”€å”®ææˆã€ç»©æ•ˆå¥–é‡‘ç­‰éšæ”¶å…¥å˜åŠ¨çš„éƒ¨åˆ†</p>
                        </div>

                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">å¹³å°æ‰£ç‚¹/æ‰‹ç»­è´¹ç‡</label>
                            <div class="relative">
                                <input type="number" id="platformRate" class="w-full pl-4 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" step="0.1" oninput="calculate()">
                                <span class="absolute right-3 top-2 text-gray-500">%</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-600 mb-1">å…¶ä»–å˜åŠ¨è´¹ç”¨ç‡ï¼ˆç®¡ç†è´¹/ç¨è´¹ç­‰ï¼‰</label>
                            <div class="relative">
                                <input type="number" id="otherVariableRate" class="w-full pl-4 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" step="0.1" oninput="calculate()">
                                <span class="absolute right-3 top-2 text-gray-500">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¿åˆ©ç‚¹è®¾ç½® -->
                <div class="mb-6 bg-gradient-to-r from-indigo-50 to-purple-50 p-4 rounded-xl border-2 border-indigo-200">
                    <h3 class="text-lg font-semibold text-indigo-800 mb-3 flex items-center">
                        <span class="bg-indigo-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 text-xs">â˜…</span>
                        ä¿åˆ©ç‚¹è®¾ç½®ï¼ˆç›®æ ‡åˆ©æ¶¦ï¼‰
                    </h3>
                    
                    <div class="input-group highlight-input rounded-lg">
                        <label class="block text-sm font-bold text-indigo-700 mb-1">ç›®æ ‡åˆ©æ¶¦ï¼ˆæ¯æœˆï¼‰</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-indigo-600 font-bold">Â¥</span>
                            <input type="number" id="targetProfit" class="w-full pl-8 pr-4 py-3 border-2 border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-lg font-bold text-indigo-800" placeholder="è¾“å…¥ç›®æ ‡åˆ©æ¶¦ï¼Œå¦‚ï¼š10000" oninput="calculate()">
                        </div>
                        <p class="text-xs text-indigo-600 mt-1">è¾“å…¥æ‚¨å¸Œæœ›å®ç°çš„æœˆåº¦å‡€åˆ©æ¶¦ç›®æ ‡</p>
                    </div>
                </div>

                <button onclick="resetForm()" class="w-full py-2 border-2 border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                    é‡ç½®æ•°æ®
                </button>
            </div>

            <!-- å³ä¾§ï¼šç»“æœå±•ç¤º -->
            <div class="space-y-6">
                <!-- åŒç»“æœå¡ç‰‡ -->
                <div class="grid gap-4">
                    <!-- ä¿æœ¬ç‚¹å¡ç‰‡ -->
                    <div class="result-card rounded-2xl p-6 text-white shadow-2xl">
                        <div class="flex justify-between items-start mb-2">
                            <h2 class="text-lg font-semibold opacity-90">æœˆåº¦ä¿æœ¬ç‚¹</h2>
                            <span class="bg-white/20 px-3 py-1 rounded-full text-xs">é›¶åˆ©æ¶¦</span>
                        </div>
                        <div class="text-4xl font-bold mb-1" id="breakEvenPoint">Â¥0</div>
                        <p class="opacity-80 text-sm mb-4">è¦†ç›–æ‰€æœ‰æˆæœ¬çš„æœ€ä½è¥ä¸šé¢</p>
                        
                        <div class="grid grid-cols-2 gap-3 pt-3 border-t border-white/30 text-sm">
                            <div>
                                <div class="opacity-80 text-xs">æ—¥å‡é”€å”®</div>
                                <div class="text-lg font-bold" id="breakEvenDaily">Â¥0</div>
                            </div>
                            <div>
                                <div class="opacity-80 text-xs">å›ºå®šæˆæœ¬</div>
                                <div class="text-lg font-bold" id="breakEvenFixed">Â¥0</div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¿åˆ©ç‚¹å¡ç‰‡ -->
                    <div class="result-card-profit rounded-2xl p-6 text-white shadow-2xl relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-white/20 w-32 h-32 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                        <div class="flex justify-between items-start mb-2 relative z-10">
                            <h2 class="text-lg font-semibold opacity-90 flex items-center">
                                <span class="mr-2">ğŸ¯</span> æœˆåº¦ä¿åˆ©ç‚¹
                            </h2>
                            <span class="bg-white/20 px-3 py-1 rounded-full text-xs">ç›®æ ‡åˆ©æ¶¦ï¼š<span id="targetProfitDisplay">Â¥0</span></span>
                        </div>
                        <div class="text-4xl font-bold mb-1 relative z-10" id="targetRevenuePoint">Â¥0</div>
                        <p class="opacity-80 text-sm mb-4 relative z-10">å®ç°ç›®æ ‡åˆ©æ¶¦æ‰€éœ€çš„è¥ä¸šé¢</p>
                        
                        <div class="grid grid-cols-3 gap-2 pt-3 border-t border-white/30 text-sm relative z-10">
                            <div>
                                <div class="opacity-80 text-xs">æ—¥å‡é”€å”®</div>
                                <div class="text-base font-bold" id="targetDaily">Â¥0</div>
                            </div>
                            <div>
                                <div class="opacity-80 text-xs">æ€»æˆæœ¬</div>
                                <div class="text-base font-bold" id="targetTotalCost">Â¥0</div>
                            </div>
                            <div>
                                <div class="opacity-80 text-xs">å‡€åˆ©æ¶¦</div>
                                <div class="text-base font-bold text-yellow-200" id="targetNetProfit">Â¥0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å·®è·åˆ†æ -->
                <div class="glass-panel rounded-2xl p-6 shadow-xl bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ“Š</span> å·®è·åˆ†æ
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-xl shadow-sm">
                            <div class="text-sm text-gray-600 mb-1">ä¿åˆ©ç‚¹ vs ä¿æœ¬ç‚¹</div>
                            <div class="text-2xl font-bold text-indigo-600" id="gapAmount">Â¥0</div>
                            <div class="text-xs text-gray-500 mt-1">éœ€å¤šå®Œæˆ <span id="gapPercent">0%</span> çš„è¥ä¸šé¢</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm">
                            <div class="text-sm text-gray-600 mb-1">å®‰å…¨è¾¹é™…</div>
                            <div class="text-2xl font-bold text-green-600" id="safetyMargin">0%</div>
                            <div class="text-xs text-gray-500 mt-1">æ”¶å…¥å¯ä¸‹é™ç©ºé—´</div>
                        </div>
                    </div>
                </div>

                <!-- æˆæœ¬ç»“æ„åˆ†æ -->
                <div class="glass-panel rounded-2xl p-6 shadow-xl">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“ˆ ä¿åˆ©ç‚¹æˆæœ¬ç»“æ„</h3>
                    
                    <div class="space-y-3" id="costStructure">
                        <div class="cost-item flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-gray-700">å›ºå®šæˆæœ¬</span>
                            <span class="font-bold text-gray-800" id="profitFixedCost">Â¥0</span>
                        </div>
                        <div class="cost-item flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                            <span class="text-gray-700">å˜åŠ¨æˆæœ¬ï¼ˆå«äººå·¥ææˆï¼‰</span>
                            <span class="font-bold text-orange-600" id="profitVariableCost">Â¥0</span>
                        </div>
                        <div class="cost-item flex justify-between items-center p-3 bg-indigo-50 rounded-lg border-2 border-indigo-200">
                            <span class="text-gray-700 font-medium">ç›®æ ‡å‡€åˆ©æ¶¦</span>
                            <span class="font-bold text-indigo-600" id="profitTargetProfit">Â¥0</span>
                        </div>
                        <div class="h-px bg-gray-200 my-2"></div>
                        <div class="cost-item flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                            <span class="text-gray-700 font-bold">ä¿åˆ©ç‚¹è¥ä¸šé¢</span>
                            <span class="font-bold text-blue-600 text-lg" id="profitRevenueTotal">Â¥0</span>
                        </div>
                    </div>

                    <!-- å¯è§†åŒ–è¿›åº¦æ¡ -->
                    <div class="mt-4 space-y-2">
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>æˆæœ¬åˆ©æ¶¦å æ¯”</span>
                        </div>
                        <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden flex">
                            <div id="barFixed" class="h-full bg-gray-500 transition-all duration-500" style="width: 0%"></div>
                            <div id="barVariable" class="h-full bg-orange-400 transition-all duration-500" style="width: 0%"></div>
                            <div id="barProfit" class="h-full bg-indigo-500 transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span class="flex items-center"><span class="w-2 h-2 bg-gray-500 rounded-full mr-1"></span>å›ºå®š</span>
                            <span class="flex items-center"><span class="w-2 h-2 bg-orange-400 rounded-full mr-1"></span>å˜åŠ¨</span>
                            <span class="flex items-center"><span class="w-2 h-2 bg-indigo-500 rounded-full mr-1"></span>åˆ©æ¶¦</span>
                        </div>
                    </div>
                </div>

                <!-- æƒ…æ™¯æ¨¡æ‹Ÿè¡¨ -->
                <div class="glass-panel rounded-2xl p-6 shadow-xl">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“‰ æ”¶å…¥-åˆ©æ¶¦å¯¹ç…§è¡¨</h3>
                    <p class="text-sm text-gray-600 mb-3">ä¸åŒè¥ä¸šé¢æ°´å¹³ä¸‹çš„åˆ©æ¶¦æƒ…å†µ</p>
                    
                    <div class="overflow-hidden rounded-lg border border-gray-200">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left text-gray-600">è¥ä¸šé¢</th>
                                    <th class="px-3 py-2 text-right text-gray-600">æ€»æˆæœ¬</th>
                                    <th class="px-3 py-2 text-right text-gray-600">å‡€åˆ©æ¶¦</th>
                                    <th class="px-3 py-2 text-center text-gray-600">çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody id="scenarioTable" class="divide-y divide-gray-200">
                                <!-- åŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- è®¡ç®—å…¬å¼è¯´æ˜ -->
                <div class="glass-panel rounded-2xl p-6 shadow-xl bg-gradient-to-br from-gray-50 to-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">ğŸ§® è®¡ç®—å…¬å¼</h3>
                    <div class="text-sm text-gray-600 space-y-3 font-mono bg-white p-4 rounded-lg border border-gray-200">
                        <div class="bg-red-50 p-2 rounded border-l-4 border-red-400">
                            <strong class="text-red-700">ä¿æœ¬ç‚¹</strong> = å›ºå®šæˆæœ¬ Ã· (1 - å˜åŠ¨æˆæœ¬ç‡)
                        </div>
                        <div class="bg-indigo-50 p-2 rounded border-l-4 border-indigo-400">
                            <strong class="text-indigo-700">ä¿åˆ©ç‚¹</strong> = (å›ºå®šæˆæœ¬ + ç›®æ ‡åˆ©æ¶¦) Ã· (1 - å˜åŠ¨æˆæœ¬ç‡)
                        </div>
                        <div class="text-xs text-gray-500 mt-2 space-y-1">
                            <p>â€¢ å˜åŠ¨æˆæœ¬ç‡ = å•†å“æˆæœ¬ç‡ + äººå·¥ææˆç‡ + å¹³å°æ‰£ç‚¹ç‡ + å…¶ä»–å˜åŠ¨è´¹ç‡</p>
                            <p>â€¢ è¾¹é™…è´¡çŒ®ç‡ = 1 - å˜åŠ¨æˆæœ¬ç‡ï¼ˆæ¯å…ƒæ”¶å…¥ä¸­å¯ç”¨äºè¦†ç›–å›ºå®šæˆæœ¬å’Œåˆ©æ¶¦çš„éƒ¨åˆ†ï¼‰</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function formatMoney(num) {
            if (!isFinite(num)) return 'âˆ';
            return 'Â¥' + num.toLocaleString('zh-CN', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        function calculate() {
            // è·å–å›ºå®šæˆæœ¬
            const rent = parseFloat(document.getElementById('rent').value) || 0;
            const fixedLabor = parseFloat(document.getElementById('fixedLabor').value) || 0;
            const utilities = parseFloat(document.getElementById('utilities').value) || 0;
            const maintenance = parseFloat(document.getElementById('maintenance').value) || 0;
            const otherFixed = parseFloat(document.getElementById('otherFixed').value) || 0;
            
            const totalFixed = rent + fixedLabor + utilities + maintenance + otherFixed;
            
            // è·å–å˜åŠ¨æˆæœ¬ç‡ï¼ˆè½¬æ¢ä¸ºå°æ•°ï¼‰
            const cogsRate = (parseFloat(document.getElementById('cogsRate').value) || 0) / 100;
            const variableLaborRate = (parseFloat(document.getElementById('variableLaborRate').value) || 0) / 100;
            const platformRate = (parseFloat(document.getElementById('platformRate').value) || 0) / 100;
            const otherVariableRate = (parseFloat(document.getElementById('otherVariableRate').value) || 0) / 100;
            
            const totalVariableRate = cogsRate + variableLaborRate + platformRate + otherVariableRate;
            
            // è·å–ç›®æ ‡åˆ©æ¶¦
            const targetProfit = parseFloat(document.getElementById('targetProfit').value) || 0;
            
            // è®¡ç®—è¾¹é™…è´¡çŒ®ç‡
            let contributionMarginRate = 0;
            if (totalVariableRate < 1) {
                contributionMarginRate = 1 - totalVariableRate;
            }
            
            // è®¡ç®—ä¿æœ¬ç‚¹
            let breakEven = 0;
            if (totalVariableRate >= 1) {
                breakEven = Infinity;
            } else if (totalVariableRate < 0) {
                breakEven = 0;
            } else {
                breakEven = totalFixed / contributionMarginRate;
            }
            
            // è®¡ç®—ä¿åˆ©ç‚¹
            let targetRevenue = 0;
            if (totalVariableRate >= 1) {
                targetRevenue = Infinity;
            } else {
                targetRevenue = (totalFixed + targetProfit) / contributionMarginRate;
            }
            
            // æ›´æ–°ä¿æœ¬ç‚¹æ˜¾ç¤º
            document.getElementById('breakEvenPoint').textContent = formatMoney(breakEven);
            document.getElementById('breakEvenDaily').textContent = breakEven === Infinity ? '-' : formatMoney(breakEven / 30);
            document.getElementById('breakEvenFixed').textContent = formatMoney(totalFixed);
            
            // æ›´æ–°ä¿åˆ©ç‚¹æ˜¾ç¤º
            document.getElementById('targetProfitDisplay').textContent = formatMoney(targetProfit);
            document.getElementById('targetRevenuePoint').textContent = formatMoney(targetRevenue);
            document.getElementById('targetDaily').textContent = targetRevenue === Infinity ? '-' : formatMoney(targetRevenue / 30);
            
            // ä¿åˆ©ç‚¹æ—¶çš„æˆæœ¬åˆ†æ
            if (targetRevenue > 0 && targetRevenue !== Infinity) {
                const variableCostAtTarget = targetRevenue * totalVariableRate;
                const totalCostAtTarget = totalFixed + variableCostAtTarget;
                const actualProfit = targetRevenue - totalCostAtTarget;
                
                document.getElementById('targetTotalCost').textContent = formatMoney(totalCostAtTarget);
                document.getElementById('targetNetProfit').textContent = formatMoney(actualProfit);
                
                // æˆæœ¬ç»“æ„æ˜ç»†
                document.getElementById('profitFixedCost').textContent = formatMoney(totalFixed);
                document.getElementById('profitVariableCost').textContent = formatMoney(variableCostAtTarget);
                document.getElementById('profitTargetProfit').textContent = formatMoney(targetProfit);
                document.getElementById('profitRevenueTotal').textContent = formatMoney(targetRevenue);
                
                // è¿›åº¦æ¡
                const fixedPercent = (totalFixed / targetRevenue * 100).toFixed(1);
                const variablePercent = (variableCostAtTarget / targetRevenue * 100).toFixed(1);
                const profitPercent = (targetProfit / targetRevenue * 100).toFixed(1);
                
                document.getElementById('barFixed').style.width = fixedPercent + '%';
                document.getElementById('barVariable').style.width = variablePercent + '%';
                document.getElementById('barProfit').style.width = profitPercent + '%';
                
                // å·®è·åˆ†æ
                const gap = targetRevenue - breakEven;
                const gapPercent = breakEven > 0 ? ((gap / breakEven) * 100).toFixed(1) : 0;
                document.getElementById('gapAmount').textContent = formatMoney(gap);
                document.getElementById('gapPercent').textContent = gapPercent + '%';
                
                // å®‰å…¨è¾¹é™…ï¼ˆä¿åˆ©ç‚¹æ—¶ï¼Œæ”¶å…¥å¯ä¸‹é™å¤šå°‘ä»èƒ½ä¿æŒç›®æ ‡åˆ©æ¶¦ï¼‰
                const safetyMargin = targetProfit > 0 ? ((targetRevenue - breakEven) / targetRevenue * 100).toFixed(1) : 0;
                document.getElementById('safetyMargin').textContent = safetyMargin + '%';
            } else {
                document.getElementById('targetTotalCost').textContent = '-';
                document.getElementById('targetNetProfit').textContent = '-';
                document.getElementById('profitFixedCost').textContent = '-';
                document.getElementById('profitVariableCost').textContent = '-';
                document.getElementById('profitTargetProfit').textContent = '-';
                document.getElementById('profitRevenueTotal').textContent = '-';
                document.getElementById('gapAmount').textContent = '-';
                document.getElementById('gapPercent').textContent = '-';
                document.getElementById('safetyMargin').textContent = '-';
                document.getElementById('barFixed').style.width = '0%';
                document.getElementById('barVariable').style.width = '0%';
                document.getElementById('barProfit').style.width = '0%';
            }
            
            // ç”Ÿæˆæƒ…æ™¯æ¨¡æ‹Ÿè¡¨
            generateScenarios(totalFixed, totalVariableRate, breakEven, targetRevenue, targetProfit);
        }

        function generateScenarios(fixedCost, variableRate, breakEvenPoint, targetPoint, targetProfit) {
            const tbody = document.getElementById('scenarioTable');
            tbody.innerHTML = '';
            
            let scenarios = [];
            
            if (breakEvenPoint === Infinity || breakEvenPoint === 0) {
                // ä½¿ç”¨å›ºå®šæ•°å€¼
                scenarios = [10000, 20000, 30000, 40000, 50000];
            } else {
                scenarios = [
                    breakEvenPoint * 0.5,   // ä¸¥é‡äºæŸ
                    breakEvenPoint * 0.8,   // æ¥è¿‘ä¿æœ¬
                    breakEvenPoint,         // ä¿æœ¬
                    targetPoint || breakEvenPoint * 1.3,  // ä¿åˆ©æˆ–ç›ˆåˆ©30%
                    targetPoint ? targetPoint * 1.2 : breakEvenPoint * 1.5  // è¶…é¢å®Œæˆ
                ];
            }
            
            scenarios.forEach(revenue => {
                if (revenue <= 0) return;
                
                const variableCost = revenue * variableRate;
                const totalCost = fixedCost + variableCost;
                const profit = revenue - totalCost;
                const isProfit = profit > 0;
                const isBreakEven = Math.abs(profit) < 1;
                const isTarget = targetProfit > 0 && Math.abs(profit - targetProfit) < 1;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors' + (isTarget ? ' bg-indigo-50' : '');
                
                let statusBadge = '';
                if (isTarget) {
                    statusBadge = '<span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold">ğŸ¯ ç›®æ ‡</span>';
                } else if (isBreakEven) {
                    statusBadge = '<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium">ä¿æœ¬</span>';
                } else if (isProfit) {
                    statusBadge = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">ç›ˆåˆ©</span>';
                } else {
                    statusBadge = '<span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">äºæŸ</span>';
                }
                
                row.innerHTML = `
                    <td class="px-3 py-2 font-medium text-gray-800">${formatMoney(revenue)}</td>
                    <td class="px-3 py-2 text-right text-gray-600">${formatMoney(totalCost)}</td>
                    <td class="px-3 py-2 text-right font-bold ${isProfit ? 'text-green-600' : isBreakEven ? 'text-gray-600' : 'text-red-600'}">${formatMoney(profit)}</td>
                    <td class="px-3 py-2 text-center">${statusBadge}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function resetForm() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => input.value = '');
            calculate();
        }

        // åˆå§‹åŒ–
        calculate();
    </script>
</body>
</html>
